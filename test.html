<html>
  <head>
    <link href="css/theme.css" rel="stylesheet"  type="text/css">
    <script type="text/javascript" src="http://www.nextgenetics.net/data/ext/mousetrap.min.js"></script>
    <script type="text/javascript" src="http://www.nextgenetics.net/data/ext/d3.v2.js"></script>
    <script type="text/javascript" src="http://www.nextgenetics.net/data/js/seeker.util.js"></script>
    <script type="text/javascript" src="http://www.nextgenetics.net/data/js/seeker.control.js"></script>
    <script type="text/javascript" src="http://www.nextgenetics.net/data/js/seeker.annotator.js"></script>
    <style>
    #topBar {
      display:inline;
      position:absolute;
      top:0;
      left:0;
      background:#365791;
      padding:4px 10px 3px 400px;
      border-bottom:4px solid #C9C9C9;
      overflow:hidden;
      box-shadow: 1px 2px 10px rgba(0, 0, 0, .5);
      -webkit-box-shadow: 1px 2px 10px rgba(0, 0, 0, .5);
      -moz-box-shadow: 1px 2px 10px rgba(0, 0, 0, .5);

    z-index:500;
    }

    #logo {
      top:2;
      left:60;
      font-family:Arial;
      font-size:17pt;
      letter-spacing:3px;
      font-weight:bold;
      color:#C9C9C9;
      position:absolute;
    }

    body {
      overflow:hidden;
    }
    </style>
  </head>
  <body>
  <script>
  var dim = seeker.util.winDimensions();

  //setup top logo and navigation bar
  var menu = d3.select(document.body)
    .append('div')
    .style('width',dim[0])
    .attr('id','topBar');

  var logo = menu
    .append('div')
    .attr('id','logo')
    .text('ANNOTATION VIEWER');

  var nav = menu
    .append('ul')
    .style('top',0)
    .attr('id','navigation')
    .selectAll('menuItems')
    .data(['input','sequences','features','selection','options','export','?'])
    .enter()
    .append('li')
    .text(function(d) {
      return d;
    })
    .attr('id', function(d) {
      return 'menu_' + d;
    });

  //setup annotator
  var anno = new seeker.annotator()
    .attachTo(document.body)
    .layout(dim[0],dim[1] - menu.node().offsetHeight,0,menu.node().offsetHeight)
    .initialize();

  anno.setProp('seqLength',dim[0] - (anno.settings['margin'] * 2) - 20);

  //setup status pop up
  var stat = new seeker.status(document.body);

  stat
    .setPosition(function() {
      var winDim = seeker.util.winDimensions();
      return [winDim[0] / 2 - this.offsetWidth / 2, 30]
    });

  anno.setStatus(stat);

  //create menus for top navigation bar
  var seqMenu = document.createElement('ul');
  document.body.appendChild(seqMenu);

  d3.select(seqMenu)
    .style('top',-1000)
    .style('left',d3.select('#menu_sequences').node().offsetLeft + 400)
    .attr('id','navMenu')
    .style('display','inline-block');

  var seqItems = d3.select(seqMenu)
    .selectAll('seqItems')
    .data(anno.data['seqs'])
    .enter()
    .append('li');

  seqItems
    .html(function(d,i) {
      return "<input type='checkbox' style='top:3px;position:relative;left:-5px'>" + (i + 1) + ". " + d['name'];
    })

  function updateSeqItems() {
    seqItems
      .each(function(d,i) {
        var cb = d3.select(this).select('input');

        if (anno.data['seqs'][i]['show']) {
          cb.node().checked = true;
        } else {
          cb.node().checked = false;
        }
      });
  }

  updateSeqItems();
  anno.onUpdate(updateSeqItems);  //update sequence items checkbox on annotator update

  seqItems
    .each(function(d,i) {
      var cb = d3.select(this).select('input');

      cb
        .on('click', function() {
          d3.event.stopPropagation();

          if (this.checked) {
            anno.data['seqs'][i]['show'] = true;
          } else {
            anno.data['seqs'][i]['show'] = false;
          }
          anno.update();
        });
    });

  //hook up functions to menu bar
  d3.select('#menu_sequences')
    .on('click',function() {
      d3.event.preventDefault();
      d3.event.stopPropagation();

      if (seeker.env_menuTarget != this) {
        seeker.env_closeMenus();
        seqMenu.style.display = 'inline-block';
        seqMenu.style.top = menu.node().offsetHeight -4;
        seeker.env_menuTarget = this;
      } else {
        seeker.env_closeMenus();
      }
    })

  d3.select('#menu_export')
    .on('click',anno.preview);

  //misc
  seqMenu.style.width = seqMenu.offsetWidth + 20;  //account for scroll bar
  function layout() {
    if (seqMenu.offsetHeight > dim[1] - menu.node().offsetHeight) {
      seqMenu.style.height = dim[1] - menu.node().offsetHeight - 50;
    }

    if (seqMenu.offsetWidth + seqMenu.offsetLeft > dim[0]) {
      seqMenu.style.width = dim[0] - seqMenu.offsetLeft - 20;
    }
  }

  seeker.env_menuTarget = seqMenu;
  seeker.env_menus.push(seqMenu);

  layout();
  </script>
  </body>
</html>